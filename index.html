<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wedding Seat Finder</title>
<style>
:root { --theme-color:#c084fc; }

html, body {
  margin:0; padding:0; height:100%;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
}

body {
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  overflow:hidden;

  /* Background image + semi-transparent overlay */
  background: 
    linear-gradient(rgba(255,255,255,0.85), rgba(255,255,255,0.85)),
    url("background.png") no-repeat center center fixed;
  background-size: cover;
}

.container{
  width:100%;
  max-width:480px;
  text-align:center;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}

.card{
  background:white;
  border-radius:22px;
  padding:36px 28px;
  box-shadow:0 20px 40px rgba(0,0,0,.15);
  animation:fadeUp .8s ease forwards;
  display:flex;
  flex-direction:column;
  align-items:center;
  width:100%;
}

@keyframes fadeUp{
  from{opacity:0; transform:translateY(20px)}
  to{opacity:1; transform:none}
}

h1{
  font-size:24px;
  margin-bottom:8px;
  line-height:1.3;
  font-weight:600;
  text-align:center;
}

.subtitle{color:#555; margin-bottom:20px}

input{
  width:90%;
  max-width:350px;
  padding:16px;
  font-size:18px;
  border-radius:14px;
  border:1px solid #ddd;
  text-align:center;
  margin-bottom:12px;
}

input:focus{
  outline:none;
  border-color:var(--theme-color);
  box-shadow:0 0 0 4px rgba(192,132,252,.25);
}

.results{
  margin-top:18px;
  display:flex;
  flex-direction:column;
  gap:10px;
  width:100%;
}

.result{
  background:#f9fafb;
  border-radius:14px;
  padding:14px;
  cursor:pointer;
}

.result:hover{
  background:#e0d4f7;
}

.name{font-weight:600}
.seat{
  font-size:20px;
  font-weight:700;
  color:#ff0000;
  margin-top:4px;
}

/* POPUP */
.popup{
  position:fixed;
  top:50%; left:50%;
  transform:translate(-50%,-50%) scale(.6);
  opacity:0;
  background:#fff5f7;
  border-radius:26px;
  padding:36px 30px;
  box-shadow:0 25px 70px rgba(0,0,0,.25);
  text-align:center;
  z-index:20;
  transition:.5s ease;
  display:flex;
  flex-direction:column;
  align-items:center;
  pointer-events:none;
}

.popup.show{
  transform:translate(-50%,-50%) scale(1);
  opacity:1;
  pointer-events:auto;
  animation:glow 2s ease-in-out infinite;
}

@keyframes glow{
  0%{box-shadow:0 0 0 rgba(255,120,160,.4)}
  50%{box-shadow:0 0 30px rgba(255,120,160,.6)}
  100%{box-shadow:0 0 0 rgba(255,120,160,.4)}
}

/* PETALS */
.petal{
  position:fixed;
  top:-40px;
  font-size:22px;
  animation:fall linear forwards;
  pointer-events:none;
  z-index:10;
}

@keyframes fall{
  to{transform:translateY(110vh) rotate(360deg);opacity:0}
}
</style>
</head>

<body>

<div class="container">
  <div class="card">
    <h1 id="title"></h1>
    <div class="subtitle">Type your name below</div>
    <input id="search" placeholder="Start typing your name">
    <div id="results" class="results"></div>
  </div>
</div>

<div id="popup" class="popup">
  <div class="name" id="pName"></div>
  <div class="seat" id="pSeat"></div>
</div>

<script>
// Couple info
const couple = { first:"Charlie", second:"Jennifer", date:"26-09-26" };
// Multi-line title
document.getElementById("title").innerHTML = `
  <div>Welcome to</div>
  <div>${couple.first} & ${couple.second}'s</div>
  <div>Wedding ${couple.date}</div>
`;

// CSV source
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRTHOySmu1LqBL9y25rwBHDflfv4TOwbmgUB8oJkxfMqQuSs9iEeYz29KoRQNyQYEcAoqZ2EPtPR7D3/pub?gid=0&single=true&output=csv";

let guests=[];

// Normalize text: lowercase & remove spaces
const normalize = s => s.toLowerCase().replace(/\s+/g,"");

// Fetch CSV
fetch(CSV_URL)
  .then(r => r.text())
  .then(text => {
    const rows = text.trim().split("\n").slice(1);
    guests = rows.map(r=>{
      const [first,last,table,seat] = r.split(",");
      return {
        first, last,
        name: first + " " + last,
        table, seat,
        normalized: normalize(first + last)
      };
    });
  });

// DOM references
const input = document.getElementById("search");
const resultsDiv = document.getElementById("results");
const popup = document.getElementById("popup");

input.addEventListener("input", () => {
  const query = input.value.toLowerCase().trim();
  resultsDiv.innerHTML = "";
  popup.classList.remove("show");

  if(!query) return;

  // split query by spaces for partial matching
  const queryParts = query.split(/\s+/).map(normalize);

  // filter matches where every part is included in first+last
  const matches = guests.filter(g =>
    queryParts.every(p => g.normalized.includes(p))
  );

  if(matches.length===1){
    showPopup(matches[0]);
    return;
  }

  matches.forEach(g=>{
    const div = document.createElement("div");
    div.className = "result";
    div.innerHTML = `<div class="name">${g.name}</div><div class="seat">Table ${g.table} Â· Seat ${g.seat}</div>`;
    div.onclick = () => showPopup(g);
    resultsDiv.appendChild(div);
  });
});

function showPopup(g){
  popup.querySelector("#pName").textContent = g.name;
  popup.querySelector("#pSeat").textContent = `Table ${g.table} Â· Seat ${g.seat}`;
  popup.classList.add("show");
  petals();
}

// Petal animation
function petals(){
  for(let i=0;i<16;i++){
    const p = document.createElement("div");
    p.className="petal";
    p.textContent="ðŸŒ¸";
    p.style.left = Math.random()*100 + "vw";
    p.style.animationDuration = (2+Math.random()*2) + "s";
    document.body.appendChild(p);
    setTimeout(()=>p.remove(),4000);
  }
}
</script>

</body>
</html>
